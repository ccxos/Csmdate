<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chainsaw Man 212 — Countdown</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#05070d; --bg2:#0a1122; --bg3:#0b1328;
      --txt:#eaf0ff; --muted:#a7b1d6; --stroke:rgba(255,255,255,.12);
      --glass:rgba(255,255,255,.06);
      --accent:#b9c8ff; --accent2:#ffdca8;
      --glow-strong:0 0 40px rgba(130,160,255,.18), 0 0 120px rgba(80,120,255,.12);
      --glow-soft:0 0 20px rgba(110,140,255,.22);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    /* اجعل كل العناصر ترث خطّ الجسم */
    body, button, input, select, textarea { font-family: inherit; }

    body{
      margin:0; color:var(--txt);
      background:radial-gradient(1100px 680px at 50% -10%, var(--bg3), var(--bg2) 45%, var(--bg1) 100%);
      overflow-y:auto; overflow-x:hidden;
    }

    /* Nightosphere-like ambience */
    .layer{position:fixed; inset:0; pointer-events:none}
    .stars{opacity:.22; background:
      radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(1.5px 1.5px at 70% 20%, rgba(255,255,255,.35), transparent 60%),
      radial-gradient(1.4px 1.4px at 30% 70%, rgba(255,255,255,.30), transparent 60%),
      radial-gradient(1.2px 1.2px at 60% 60%, rgba(255,255,255,.26), transparent 60%);
      animation: twinkle 9s ease-in-out infinite alternate}
    @keyframes twinkle{from{transform:translate3d(-0.6%,0,0)}to{transform:translate3d(0.6%,0,0)}}

    .fog::before,.fog::after{content:""; position:absolute; inset:-18vh -18vw; filter:blur(28px); mix-blend-mode:screen;
      background: radial-gradient(48vw 28vh at 18% 16%, rgba(150,180,255,.08), transparent 60%),
                  radial-gradient(40vw 30vh at 82% 12%, rgba(255,200,170,.06), transparent 60%),
                  radial-gradient(70vw 45vh at 50% 86%, rgba(180,210,255,.06), transparent 60%);
      animation:fog 80s linear infinite alternate}
    .fog::after{animation-duration:110s; transform:scale(1.1); opacity:.9}
    @keyframes fog{from{transform:translate3d(-1.3%,0,0)}to{transform:translate3d(1.2%,0,0)}}

    .grain{opacity:.05; mix-blend-mode:screen; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="1.1" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.35"/></svg>'); background-size:140px 140px}

    .wrap{min-height:100%; display:grid; place-items:center; padding:4vmin}

    .card{
      position:relative; width:min(940px, 92vw); border-radius:28px; padding:28px 26px;
      backdrop-filter: blur(14px) saturate(118%);
      background:linear-gradient(180deg, rgba(8,12,22,.55), rgba(8,12,22,.38));
      border:1px solid var(--stroke); box-shadow:var(--glow-strong)
    }
    .halo{position:absolute; inset:-2px; border-radius:28px; pointer-events:none;
      background:radial-gradient(60% 60% at 50% 0%, rgba(157,180,255,.16), transparent 60%); filter:blur(22px)}

    .topbar{display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:6px}
    .langBtn{border:1px solid var(--stroke); background:var(--glass); color:var(--txt); padding:8px 12px; border-radius:999px; cursor:pointer}

    .title{display:flex; flex-direction:column; gap:4px}
    h1{margin:0; font-size:clamp(22px,4.4vw,40px); letter-spacing:.02em; text-shadow:var(--glow-soft)}
    .subtitle{margin:0; color:var(--muted)}

    /* Countdown */
    .countdown{display:flex; gap:16px; flex-wrap:wrap; align-items:center; justify-content:center; margin:22px 0 8px}
    .unit{min-width:120px; padding:16px 18px; border-radius:18px; text-align:center; background:rgba(255,255,255,.06); border:1px solid var(--stroke); transform:translateY(12px); opacity:0; animation:rise .9s ease forwards}
    .unit:nth-child(2){animation-delay:.06s} .unit:nth-child(3){animation-delay:.12s} .unit:nth-child(4){animation-delay:.18s}
    @keyframes rise{to{transform:translateY(0); opacity:1}}

    .num{position:relative; font-weight:800; font-size:40px; line-height:1; display:inline-block; padding:2px 6px; border-radius:10px}
    .num.flip{animation:flip .5s ease}
    @keyframes flip{0%{transform:rotateX(0)}50%{transform:rotateX(90deg); opacity:.6}100%{transform:rotateX(0); opacity:1}}

    .lab{font-size:12px; color:var(--muted); margin-top:6px; letter-spacing:.14em; text-transform:uppercase}

    .chipRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center; color:var(--muted); margin:10px 0 0}
    .chip{border:1px solid var(--stroke); border-radius:999px; padding:8px 12px; background:rgba(255,255,255,0.05)}

    /* Accordion */
    .accordion{margin-top:12px}
    .acc-head{
      display:flex; align-items:center; justify-content:center; gap:8px;
      cursor:pointer; user-select:none; padding:10px 14px; border-radius:12px;
      border:1px solid var(--stroke); background:var(--glass);
    }
    .acc-head .arrow{transition:transform .25s ease}
    .acc-head.open .arrow{transform:rotate(180deg)}
    .acc-body{
      overflow:hidden; transition:max-height .32s ease, opacity .25s ease;
      max-height:0; opacity:0;
    }
    .acc-body.open{opacity:1}

    .tzList{display:grid; gap:10px; padding:14px 6px}
    .tzRow{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border:1px solid var(--stroke); background:rgba(255,255,255,.05);
      border-radius:14px; padding:12px 14px;
    }
    .tzLabel{font-weight:700; color:var(--txt)}
    .tzWhen{color:var(--muted)}

    /* Language modal */
    .modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(5,8,14,.55); backdrop-filter: blur(6px); z-index:20}
    .modal.show{display:grid}
    .modalCard{width:min(540px, 92vw); background:linear-gradient(180deg, rgba(8,12,22,.75), rgba(8,12,22,.55)); border:1px solid var(--stroke); border-radius:20px; padding:20px; box-shadow:var(--glow-strong)}
    .modalActions{display:flex; gap:12px; flex-wrap:wrap; justify-content:center; margin-top:8px}

    /* RTL + fonts */
    [dir="rtl"] .title{align-items:flex-end}
    [dir="rtl"] .subtitle{text-align:right}
    body[lang="ar"]{font-family:"Scheherazade New", system-ui, -apple-system, Segoe UI, Tahoma, Arial}
    body[lang="en"]{font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Arial}
  </style>
</head>
<body lang="en">
  <div class="layer stars"></div>
  <div class="layer fog"></div>
  <div class="layer grain"></div>

  <main class="wrap">
    <section class="card" id="card">
      <div class="halo"></div>

      <div class="topbar">
        <div class="title">
          <h1 id="ttl">Chainsaw Man — Chapter 212</h1>
          <p class="subtitle" id="sub">Made by Ali Ahmed</p>
        </div>
        <button class="langBtn" id="langToggle" title="Change language">🌐 Language</button>
      </div>

      <!-- Main countdown: Baghdad -->
      <div class="countdown" id="countdown">
        <div class="unit"><div class="num" id="d">0</div><div class="lab" id="lab_days">Days</div></div>
        <div class="unit"><div class="num" id="h">12</div><div class="lab" id="lab_hours">Hours</div></div>
        <div class="unit"><div class="num" id="m">00</div><div class="lab" id="lab_minutes">Minutes</div></div>
        <div class="unit"><div class="num" id="s">00</div><div class="lab" id="lab_seconds">Seconds</div></div>
      </div>

      <div class="chipRow">
        <span class="chip" id="zoneChip">Baghdad (Asia/Baghdad)</span>
        <span class="chip" id="whenChip">Aug 19, 2025 · 06:00 PM</span>
      </div>

      <!-- Accordion: Other time zones (dates only) -->
      <div class="accordion">
        <div class="acc-head" id="accHead">
          <span id="accLabel">Other Time Zones</span>
          <span class="arrow">▾</span>
        </div>
        <div class="acc-body" id="accBody">
          <div class="tzList" id="tzList"><!-- rows injected by JS --></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Language modal -->
  <div class="modal" id="langModal" aria-modal="true" role="dialog">
    <div class="modalCard">
      <h2 style="margin:0 0 8px" id="langTitle">🌐 Choose your language</h2>
      <p style="margin:0 0 14px; color:var(--muted)" id="langHelp">You can change it later from the top-right button.</p>
      <div class="modalActions">
        <button class="langBtn" data-lang="en">English</button>
        <button class="langBtn" data-lang="ar">العربية</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Config =====
    // Baghdad primary event: Aug 19, 2025 18:00 Asia/Baghdad -> 2025-08-19T15:00:00Z
    const MAIN_TARGET_UTC = '2025-08-19T15:00:00Z';

    // Other events (explicit UTC instants as طلبتَ)
    const OTHER_EVENTS = [
      { key:'pt',  labelEn:'Pacific Time (PT) — 8:00 AM',     labelAr:'توقيت المحيط الهادئ (PT) — 8:00 صباحًا', tz:'America/Los_Angeles', utc:'2025-08-19T15:00:00Z' },
      { key:'ct',  labelEn:'Central Time (CT) — 5:00 PM',     labelAr:'التوقيت المركزي (CT) — 5:00 مساءً',      tz:'America/Chicago',     utc:'2025-08-19T22:00:00Z' },
      { key:'et',  labelEn:'Eastern Time (ET) — 11:00 AM',    labelAr:'التوقيت الشرقي (ET) — 11:00 صباحًا',     tz:'America/New_York',    utc:'2025-08-19T15:00:00Z' },
      { key:'gmt', labelEn:'Greenwich (GMT) — 4:00 PM',       labelAr:'غرينتش (GMT) — 4:00 مساءً',              tz:'UTC',                 utc:'2025-08-19T16:00:00Z' },
      { key:'jst', labelEn:'Japan (JST) — 12:00 AM (Aug 20)', labelAr:'اليابان (JST) — 12:00 صباحًا (20 أغسطس)', tz:'Asia/Tokyo',          utc:'2025-08-19T15:00:00Z' }
    ];

    const STR = {
      en:{
        title:'Chainsaw Man — Chapter 212',
        sub:'Made by Ali Ahmed',
        days:'Days', hours:'Hours', minutes:'Minutes', seconds:'Seconds',
        other:'Other Time Zones',
        langTitle:'Choose your language',
        langHelp:'You can change it later from the top-right button.',
        baghdad:'Baghdad (Asia/Baghdad)',
        live:'Chapter should now be live or moments away.',
        langBtn:'🌐 Language'
      },
      ar:{
        title:'رجل المنشار — الفصل 212',
        sub:'صُنع بواسطة علي أحمد',
        days:'أيام', hours:'ساعات', minutes:'دقائق', seconds:'ثوانٍ',
        other:'المناطق الزمنية الأخرى',
        langTitle:'اختر لغتك',
        langHelp:'يمكنك تغييرها لاحقًا من زر أعلى الصفحة.',
        baghdad:'بغداد (Asia/Baghdad)',
        live:'يُفترض أن الفصل متاح الآن.',
        langBtn:'🌐 اللغة'
      }
    };

    // ===== State & elements =====
    const pref = { lang: localStorage.getItem('lang') || null };

    const els = {
      d: document.getElementById('d'), h: document.getElementById('h'), m: document.getElementById('m'), s: document.getElementById('s'),
      labDays: document.getElementById('lab_days'), labHours: document.getElementById('lab_hours'), labMinutes: document.getElementById('lab_minutes'), labSeconds: document.getElementById('lab_seconds'),
      ttl: document.getElementById('ttl'), sub: document.getElementById('sub'),
      zoneChip: document.getElementById('zoneChip'), whenChip: document.getElementById('whenChip'),
      langToggle: document.getElementById('langToggle'), langModal: document.getElementById('langModal'),
      langTitle: document.getElementById('langTitle'), langHelp: document.getElementById('langHelp'),
      accHead: document.getElementById('accHead'), accBody: document.getElementById('accBody'), accLabel: document.getElementById('accLabel'),
      tzList: document.getElementById('tzList')
    };

    // Helpers
    function setNum(el, val){
      const newText = String(val);
      if(el.textContent !== newText){
        el.classList.remove('flip');
        void el.offsetWidth;
        el.textContent = newText;
        el.classList.add('flip');
      }
    }
    function hours12(h){ const v = h % 12; return v === 0 ? 12 : v; }

    // Language switch
    function setLang(l){
      pref.lang = l; localStorage.setItem('lang', l);
      document.body.setAttribute('lang', l);
      document.documentElement.lang = l;
      document.documentElement.dir = (l==='ar') ? 'rtl' : 'ltr';
      const s = STR[l];
      els.ttl.textContent = s.title;
      els.sub.textContent = s.sub;
      els.labDays.textContent = s.days;
      els.labHours.textContent = s.hours;
      els.labMinutes.textContent = s.minutes;
      els.labSeconds.textContent = s.seconds;
      els.accLabel.textContent = s.other;
      els.langTitle.textContent = '🌐 ' + s.langTitle;
      els.langHelp.textContent = s.langHelp;
      els.zoneChip.textContent = s.baghdad;
      els.langToggle.textContent = s.langBtn;

      // Chip time (Baghdad)
      const d = new Date(MAIN_TARGET_UTC);
      const fmtDate = new Intl.DateTimeFormat((l==='ar'?'ar':'en-US'), { timeZone:'Asia/Baghdad', year:'numeric', month:'short', day:'2-digit'}).format(d);
      const fmtTime = new Intl.DateTimeFormat((l==='ar'?'ar':'en-US'), { timeZone:'Asia/Baghdad', hour:'2-digit', minute:'2-digit', hour12:true }).format(d);
      els.whenChip.textContent = `${fmtDate} · ${fmtTime}`;

      // Rebuild tz list with correct labels
      buildOtherZones();
      ensureAccHeight();
    }

    // Main countdown (Baghdad)
    let mainTimer = null;
    function startMainCountdown(){
      if(mainTimer) clearInterval(mainTimer);
      const end = Date.parse(MAIN_TARGET_UTC);
      const tick = ()=>{
        const now = Date.now();
        let diff = Math.max(0, end - now);
        const totalSec = Math.floor(diff/1000);
        const days = Math.floor(totalSec / 86400);
        const rem = totalSec % 86400;
        const hours = Math.floor(rem / 3600);
        const mins = Math.floor((rem % 3600) / 60);
        const secs = rem % 60;

        setNum(els.d, days);
        setNum(els.h, String(hours12(hours)).padStart(2,'0'));
        setNum(els.m, String(mins).padStart(2,'0'));
        setNum(els.s, String(secs).padStart(2,'0'));

        if(diff === 0){
          clearInterval(mainTimer);
          els.sub.textContent = (pref.lang==='ar') ? STR.ar.live : STR.en.live;
        }
      };
      tick();
      mainTimer = setInterval(tick, 1000);
    }

    // Other zones (dates only)
    function buildOtherZones(){
      els.tzList.innerHTML = '';
      OTHER_EVENTS.forEach(ev => {
        const row = document.createElement('div');
        row.className = 'tzRow';

        const label = document.createElement('div');
        label.className = 'tzLabel';
        label.textContent = (pref.lang==='ar') ? ev.labelAr : ev.labelEn;

        const when = document.createElement('div');
        when.className = 'tzWhen';

        const d = new Date(ev.utc);
        const langTag = (pref.lang==='ar' ? 'ar' : 'en-US');
        const fmtDate = new Intl.DateTimeFormat(langTag, { timeZone: ev.tz, year:'numeric', month:'short', day:'2-digit'}).format(d);
        const fmtTime = new Intl.DateTimeFormat(langTag, { timeZone: ev.tz, hour:'2-digit', minute:'2-digit', hour12:true }).format(d);
        when.textContent = `${fmtDate} · ${fmtTime}`;

        row.appendChild(label);
        row.appendChild(when);
        els.tzList.appendChild(row);
      });
    }

    // Accordion open/close with robust height handling
    function openAccordion(){
      const body = els.accBody;
      body.classList.add('open');
      body.style.maxHeight = body.scrollHeight + 'px';
      const onEnd = ()=>{ body.style.maxHeight = 'none'; body.removeEventListener('transitionend', onEnd); };
      body.addEventListener('transitionend', onEnd);
    }
    function closeAccordion(){
      const body = els.accBody;
      body.style.maxHeight = body.scrollHeight + 'px';
      requestAnimationFrame(()=>{
        body.classList.remove('open');
        body.style.maxHeight = '0px';
      });
    }
    function ensureAccHeight(){
      const body = els.accBody;
      if(body.classList.contains('open')){
        body.style.maxHeight = 'none';
      } else {
        body.style.maxHeight = '0px';
      }
    }

    (function setupAccordion(){
      const head = els.accHead;
      let open = false;
      const toggle = ()=>{
        open = !open;
        head.classList.toggle('open', open);
        open ? openAccordion() : closeAccordion();
      };
      head.addEventListener('click', toggle);
      closeAccordion();
      window.addEventListener('resize', ensureAccHeight);
    })();

    // Language modal init + fixes
    const langModal = els.langModal;
    function openLang(){ langModal.classList.add('show'); }
    function closeLang(){ langModal.classList.remove('show'); }
    if(!pref.lang){ openLang(); } else { setLang(pref.lang); }
    els.langToggle.addEventListener('click', openLang);
    langModal.addEventListener('click', (e)=>{ if(e.target === langModal) closeLang(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closeLang(); });
    langModal.querySelectorAll('[data-lang]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        setLang(btn.dataset.lang);
        closeLang();
      });
    });

    // Boot
    if(pref.lang) buildOtherZones();
    startMainCountdown();
  </script>
</body>
</html>
